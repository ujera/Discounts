@model IEnumerable<Discounts.Application.DTOs.Customer.ReservationResponseDto>

@{
	ViewData["Title"] = "ჩემი კუპონები";
}

<div class="container mt-5">
	<div class="d-flex justify-content-between align-items-center mb-4">
		<h2><i class="bi bi-person-lines-fill text-primary"></i> ჩემი ჯავშნები და კუპონები</h2>
	</div>

	@if (TempData["SuccessMessage"] != null)
	{
		<div class="alert alert-success alert-dismissible fade show shadow-sm" role="alert">
			<i class="bi bi-check-circle-fill"></i> @TempData["SuccessMessage"]
			<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
		</div>
	}

	@if (!Model.Any())
	{
		<div class="alert alert-light border text-center py-5 shadow-sm">
			<i class="bi bi-ticket-perforated text-muted" style="font-size: 3rem;"></i>
			<h4 class="mt-3 text-secondary">თქვენ ჯერ არ გაქვთ დაჯავშნილი კუპონები</h4>
			<a asp-controller="Home" asp-action="Index" class="btn btn-outline-primary mt-3">ფასდაკლებების ნახვა</a>
		</div>
	}
	else
	{
		<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
			@foreach (var coupon in Model)
			{
				bool isExpired = coupon.ExpiresAt < DateTime.UtcNow;

				<div class="col">
					<div class="card shadow-sm h-100 border-top border-4 @(isExpired ? "border-danger bg-light text-muted" : "border-success")">
						<div class="card-body d-flex flex-column">

							<div class="d-flex justify-content-between align-items-start mb-3">
								<h6 class="text-uppercase fw-bold mb-0">ჯავშანი #@coupon.Id</h6>
								@if (isExpired)
								{
									<span class="badge bg-danger">ვადაგასული</span>
								}
								else
								{
									<span class="badge bg-success">აქტიური</span>
								}
							</div>

							<h5 class="card-title fw-bold">@coupon.OfferTitle</h5>
							<p class="small mb-1">
								<i class="bi bi-calendar-plus"></i> დაჯავშნის დრო: @coupon.ReservedAt.ToLocalTime().ToString("g")
							</p>

							<hr class="mt-auto" />

							<div class="d-flex justify-content-between align-items-center">
								<div class="small @(isExpired ? "text-danger fw-bold" : "text-muted")">
									<i class="bi bi-clock-history"></i>
									ძალაშია: @coupon.ExpiresAt.ToLocalTime().ToString("HH:mm")
								</div>

								@if (!isExpired)
								{
									<form asp-controller="Purchase" asp-action="Buy" method="post">
										<input type="hidden" name="reservationId" value="@coupon.Id" />
										<button type="submit" class="btn btn-success btn-sm">
											<i class="bi bi-cart-check"></i> ყიდვა
										</button>
									</form>
								}
							</div>

						</div>
					</div>
				</div>
			}
		</div>
	}
</div>
