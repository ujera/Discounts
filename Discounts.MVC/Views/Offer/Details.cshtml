@model Discounts.Application.DTOs.Offer.OfferDto

@{
	ViewData["Title"] = Model.Title;
}

<div class="container mt-5">
	@if (TempData["SuccessMessage"] != null)
	{
		<div class="alert alert-success alert-dismissible fade show" role="alert">
			<i class="bi bi-check-circle-fill"></i> @TempData["SuccessMessage"]
			<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
		</div>
	}
	@if (TempData["ErrorMessage"] != null)
	{
		<div class="alert alert-danger alert-dismissible fade show" role="alert">
			<i class="bi bi-exclamation-triangle-fill"></i> @TempData["ErrorMessage"]
			<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
		</div>
	}

	<div class="row">
		<div class="col-md-6 mb-4">
			<div class="card shadow-sm border-0">
				<img src="@Model.ImageUrl" class="card-img-top rounded" alt="@Model.Title" style="width: 100%; max-height: 500px; object-fit: cover;">
			</div>
		</div>

		<div class="col-md-6">
			<h1 class="fw-bold">@Model.Title</h1>
			<p class="text-muted">კატეგორია: <span class="badge bg-secondary">@Model.CategoryName</span></p>

			<hr />

			<div class="d-flex align-items-center mb-3">
				<h2 class="text-success fw-bold me-3">@Model.DiscountPrice.ToString("C")</h2>
				<h5 class="text-decoration-line-through text-muted mb-0">@Model.OriginalPrice.ToString("C")</h5>
			</div>

			<p class="lead" style="white-space: pre-line;">
				@Model.Description
			</p>

			<div class="bg-light p-3 rounded mb-4">
				<div class="row">
					<div class="col-6">
						<strong><i class="bi bi-calendar-check"></i> დაწყება:</strong><br />
						@Model.StartDate.ToShortDateString()
					</div>
					<div class="col-6">
						<strong><i class="bi bi-calendar-x"></i> დასრულება:</strong><br />
						@Model.EndDate.ToShortDateString()
					</div>
				</div>
			</div>

			<div class="card border-0 shadow-sm">
				<div class="card-body bg-white rounded text-center p-4">

					<h5 class="mb-3">
						<i class="bi bi-ticket-detailed"></i> დარჩენილი კუპონები:
						<span class="fw-bold @(Model.CouponsCount > 0 ? "text-primary" : "text-danger")">
							@Model.CouponsCount
						</span>
					</h5>

					@if (Model.CouponsCount <= 0)
					{
						<button class="btn btn-secondary btn-lg w-100" disabled>
							<i class="bi bi-x-circle"></i> გაყიდულია
						</button>
					}
					else if (User.Identity != null && User.Identity.IsAuthenticated && User.IsInRole("Customer"))
					{
						<div class="d-grid gap-2 d-md-flex justify-content-md-center">
							<form asp-controller="Reservation" asp-action="Reserve" method="post" class="w-100">
								<input type="hidden" name="offerId" value="@Model.Id" />
								<button type="submit" class="btn btn-outline-primary btn-lg w-100">
									<i class="bi bi-clock-history"></i> დაჯავშნა
								</button>
							</form>

							<form asp-controller="Purchase" asp-action="Buy" method="post" class="w-100">
								<input type="hidden" name="offerId" value="@Model.Id" />
								<button type="submit" class="btn btn-success btn-lg w-100">
									<i class="bi bi-cart-check"></i> ყიდვა
								</button>
							</form>
						</div>
					}
					else if (User.Identity != null && User.Identity.IsAuthenticated)
					{
						<div class="alert alert-warning mb-0">
							კუპონის საყიდლად გთხოვთ შეხვიდეთ მომხმარებლის (Customer) ანგარიშით.
						</div>
					}
					else
					{
						<a asp-controller="Auth" asp-action="Login" class="btn btn-primary btn-lg w-100">
							შესვლა ყიდვისთვის
						</a>
					}
				</div>
			</div>

		</div>
	</div>
</div>
